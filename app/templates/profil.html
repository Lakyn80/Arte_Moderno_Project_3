{% extends "layout.html" %} {% block title %}M≈Øj profil{% endblock %} {% block
content %}

<div class="profile-wrapper">
  <h2 class="profile-heading">üë§ M≈Øj profil</h2>

  {% with messages = get_flashed_messages(with_categories=true) %} {% for
  category, message in messages %}
  <div class="flash flash-{{ category }}">{{ message }}</div>
  {% endfor %} {% endwith %}

  <form method="POST" class="profile-form">
    {{ form.hidden_tag() }}

    <div class="form-group">
      <label>Email</label>
      <input
        type="email"
        value="{{ current_user.email }}"
        readonly
        class="readonly-input"
      />
    </div>

    {% for fieldname in ['first_name', 'last_name', 'phone', 'address',
    'billing_address', 'city', 'postal_code', 'country', 'company',
    'company_id', 'vat_id', 'note'] %} {% if form[fieldname] %}
    <div class="form-group">
      <label>{{ form[fieldname].label }}</label>
      {{ form[fieldname](class="form-control") }} {% for error in
      form[fieldname].errors %}
      <small class="text-danger">{{ error }}</small>
      {% endfor %}
    </div>
    {% endif %} {% endfor %}

    <div class="form-group">
      <label>{{ form.date_of_birth.label }}</label>
      {{ form.date_of_birth(class="form-control", id="datepicker") }} {% for
      error in form.date_of_birth.errors %}
      <small class="text-danger">{{ error }}</small>
      {% endfor %}
    </div>

    <div class="form-actions">{{ form.submit(class="btn-order") }}</div>
  </form>

  <div class="profile-card">
    <h3>üí≥ Vizitka</h3>
    <p>
      <strong
        >{{ current_user.first_name }} {{ current_user.last_name }}</strong
      >
    </p>
    <p>{{ current_user.email }}</p>
    <p>{{ current_user.phone }}</p>
    <p>
      {{ current_user.address }}, {{ current_user.city }}, {{
      current_user.postal_code }}
    </p>
    <p>{{ current_user.country }}</p>

    {% if birthdate %} {% set today = namespace(value=datetime.utcnow()) %} {%
    set age = today.value.year - birthdate.year - ((today.value.month,
    today.value.day) < (birthdate.month, birthdate.day)) %}
    <p>
      üóìÔ∏è <strong>Datum narozen√≠:</strong> {{ birthdate.strftime('%d.%m.%Y') }}
      ({{ age }} let)
    </p>
    {% endif %} {% if current_user.company %}
    <p>
      <strong>Firma:</strong> {{ current_user.company }} (IƒåO: {{
      current_user.company_id }}, DIƒå: {{ current_user.vat_id }})
    </p>
    {% endif %} {% if current_user.note %}
    <p><em>Pozn√°mka:</em> {{ current_user.note }}</p>
    {% endif %}
  </div>

  <div class="profile-links">
    <a href="{{ url_for('views.moje_objednavky') }}" class="btn-order"
      >üì¶ Zobrazit moje objedn√°vky</a
    >
  </div>
</div>

<!-- Flatpickr -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    flatpickr("#datepicker", {
      dateFormat: "Y-m-d",
      maxDate: "today",
      altInput: true,
      altFormat: "d.m.Y",
      allowInput: true,
    });
  });
</script>

<style>
  body {
    background: #f2f4f7;
  }

  .profile-wrapper {
    max-width: 720px;
    margin: 60px auto;
    padding: 40px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
  }

  .profile-heading {
    text-align: center;
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 30px;
    color: #222;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
  }

  .form-control,
  .readonly-input {
    padding: 10px 14px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    background-color: #fff;
  }

  .readonly-input {
    background-color: #f8f9fa;
    color: #666;
  }

  .btn-order {
    padding: 12px 22px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .btn-order:hover {
    background-color: #0056b3;
  }

  .form-actions {
    text-align: center;
    margin-top: 30px;
  }

  .profile-card {
    margin-top: 50px;
    padding: 24px;
    background: #f5f8fb;
    border-left: 5px solid #007bff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
    color: #333;
  }

  .profile-card h3 {
    margin-bottom: 15px;
    font-size: 20px;
    color: #007bff;
  }

  .profile-card p {
    margin: 6px 0;
  }

  .profile-links {
    text-align: center;
    margin-top: 40px;
  }

  .text-danger {
    color: #dc3545;
    font-size: 13px;
    margin-top: 5px;
  }

  .flash-success {
    background-color: #d4edda;
    color: #155724;
    padding: 10px;
    border-left: 5px solid #28a745;
    margin-bottom: 20px;
    border-radius: 6px;
  }

  @media (max-width: 600px) {
    .profile-wrapper {
      padding: 20px;
    }

    .btn-order {
      width: 100%;
    }
  }
</style>

{% endblock %}
